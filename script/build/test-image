#!/usr/bin/env sh

set -e

[ -n "$1" ] || {
	>&2 echo First argument must be image tag.
	exit 1
}

TAG=$1
IMAGE=docker/compose-tests

DOCKER_COMPOSE_GITSHA=$(script/build/write-git-sha)
docker build -t "${IMAGE}:${TAG}" . \
	--target build \
	--build-arg BUILD_PLATFORM=debian \
	--build-arg GIT_COMMIT="${DOCKER_COMPOSE_GITSHA}"
docker tag "${IMAGE}":"${TAG}" "${IMAGE}":latest
